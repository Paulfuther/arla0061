
<!DOCTYPE html>

<html lang="en">

  <head>

   {{ moment.include_jquery() }}
   


    <!-- Required meta tags -->
   <meta charset="utf-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">

   <!-- Bootstrap CSS -->
  
 
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
   <script src="https://cdn.jsdelivr.net/npm/pikaday/pikaday.js"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/intlTelInput.min.js"></script>
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0/css/all.min.css" integrity="sha256-ybRkN9dBjhcS2qrW1z+hfCxq+1aBdwyQM5wlQoQVt/0=" crossorigin="anonymous" />
   <link rel = "stylesheet" href="/static/main.css"> 
   <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/pikaday/css/pikaday.css">
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/css/intlTelInput.css"/>
   <link rel="preconnect" href="https://fonts.googleapis.com">
   <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
   <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300&display=swap" rel="stylesheet">
   <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">
   <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-u1OknCvxWvY5kfmNBILK2hRnQC3Pr17a+RTT6rIHI7NnikvbZlHgTPOOmMi466C8" crossorigin="anonymous"></script>
   <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-u1OknCvxWvY5kfmNBILK2hRnQC3Pr17a+RTT6rIHI7NnikvbZlHgTPOOmMi466C8" crossorigin="anonymous"></script>
    
   <!-- <link rel = "stylesheet" type="text/css" href="{{url_for('static', filename='main.css')}}"> -->
  
  </head>
  <nav class="navbar navbar-expand-lg bg-light">
    <div class="container-fluid">
      <a class="navbar-brand" >Paul Futher</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link active" aria-current="page" href="{{url_for('home')}}">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="{{url_for('login')}}">Log In</a>
          </li>
         
        </ul>
      </div>
    </div>
  </nav>
  
  
        
       
                   
                      
                        <form method="POST" action = "/staff_register" enctype="multipart/form-data" class = "container-sm mx-auto  was-validated" data-multi-step >
                            {{ form.hidden_tag() }}
                        
                            <div class="newhire_card col-lg-6 col-md-8 col-sm-10 mx-auto" data-step>

                                    <div class="text-center mb-3">Step 1 of 4</div>
                           
                                    <div> {{form.firstname(class_= "form-control form-control-lg mb-3", placeholder="First Name - Required")}} </div>
                                    <div> {{form.lastname(class_ = "form-control form-control-lg mb-3", placeholder="Last Name - Required")}} </div>
                                    <label for="dob" class="form-label">Date of Birth</label>
                                    <div> {{form.dob(class_ = "form-control form-control-lg mb-3", id="dob", placeholder="Date of Birth - Required")}} </div>
                                    <div> {{form.addressone(class_ = "form-control form-control-lg mb-3", placeholder="Address one - Required")}} </div>
                                    <div> {{form.addresstwo(class_ = "form-control form-control-lg mb-3", placeholder="Address two")}} </div>
                                    <div> {{form.city(class_ = "form-control form-control-lg mb-3", placeholder="City - Required")}} </div>
                                    <div> {{form.province(class_ = "form-control form-control-lg mb-3", placeholder="Province - Required")}} </div>
                                    <div> {{form.postal(class_ = "form-control form-control-lg mb-3", placeholder="Postal Code - Required")}} </div>
                                    <div> {{form.country(class_ = "form-control form-control-lg mb-3", placeholder="Country ")}} </div>
                                    <div> {{form.sin_number(class_ = "form-control form-control-lg mb-3 required ",pattern="\d{9}", placeholder="Sin Number No Dashes - Required")}} 
                                        <div class="valid-feedback">
                                            Looks good!
                                          </div>
                                          <div class="invalid-feedback">Please enter exactly 9 digits.</div>
                                   
                                </div>
                                    <div> {{form.password(class_ = "form-control form-control-lg mb-3", placeholder="Password - Required", id="password")}} </div>
                                    
                                    <div> {{form.passwordconfirm(class = "form-control form-control-lg mb-3", placeholder="Confirm Password - Required", id="password2")}} </div>
                                    <div class="alert alert-danger alert4-error"style="display:none" role="alert">
                                        Passwords Do Not Match
                                    </div>
                                    
                                    <div> {{form.email(class = "form-control form-control-lg mb-3", autocomplete="new-password", placeholder="Email Address - Required", id="live_search_first")}} </div>
                                    <input type="hidden" id="hiddenemail" name="hiddenemail">
                                    <div class="alert alert-danger alert-error"style="display:none" role="alert">
                                        Email Already Used. Please Try Another One.
                                    </div>
                                    <div class="alert alert-success alert-info"style="display:none" role="alert">
                                        Email Is Good
                                    </div>
                                    {% with messages = get_flashed_messages() %}
                                    {% if messages %}
                                        <ul class=flashes>
                                        {% for message in messages %}
                                        <li>{{ message }}</li>
                                        {% endfor %}
                                        </ul>
                                    {% endif %}
                                    {% endwith %}
                                    
                                    <div> {{form.mobilephone(class = "form-control form-control-lg mb-3" ,id="phone", type="tel")}} 
                                        <input type="hidden" id="hiddenphone" name="hiddenphone"   >
                                                {% if form.mobilephone.errors %}
                                                    {% for error in form.mobilephone.errors %}
                                                    <div class = "formerror">{{ error }}</div>
                                                    {% endfor %}        
                                                {% endif %}
                                                <div class="alert alert-danger alert3-error"style="display:none" role="alert">
                                                    Phone Number Already Used
                                                  </div>
                                                  <div class="alert alert-success alert3-info"style="display:none" role="alert">
                                                    Phone Number Is Good
                                                  </div>
                                                  <div class="alert alert-danger alert6-error"style="display:none" role="alert">
                                                    Invalide Phone Numberee
                                                  </div>
                                    </div>
                                    <div class="d-grid gap-2">
                                    <button  id="phone_button_verify"   class="btn btn-primary mt-3" >Click to Verify Phone Number</button>
                                    </div>
                                    <div class="d-grid gap-2">
                                            <button type="button" id="phone_check"  style="display: none" class="btn btn-primary mt-3"data-next>Next</button>
                                    </div>
                                




                            </div>
                            <div  class="newhire_card col-lg-6 col-md-8 col-sm-10 mx-auto" data-step>
                                <div class="text-center mb-3">Step 2 of 4</div>  
                            <div> {{form.monavail(class = "form-control form-control-lg mb-3", placeholder="Monday Availability - Required")}} 
                        
                                        {% if form.monavail.errors %}
                                            {% for error in form.monavail.errors %}
                                            <div class = "">{{ error }}</div>
                                            {% endfor %}            
                                        {% endif %}
                            </div>
                
                        
                            <div> {{form.tueavail(class = "form-control form-control-lg mb-3", placeholder="Tuesday Availability - Required")}} 
                                        
                                        {% if form.tueavail.errors %}
                                            {% for error in form.tueavail.errors %}
                                            <div class = "formerror">{{ error }}</div>
                                            {% endfor %}            
                                        {% endif %}
                            </div>
                
                        
                            <div> {{form.wedavail(class = "form-control form-control-lg mb-3", placeholder="Wednesday Availabilit  - Required")}} 
                                        
                                        {% if form.wedavail.errors %}
                                            {% for error in form.wedavail.errors %}
                                            <div class = "formerror">{{ error }}</div>
                                            {% endfor %}            
                                        {% endif %}
                            </div>
                
                            
                            <div> {{form.thuavail(class = "form-control form-control-lg mb-3", placeholder="Thursday Availability - Required ")}} 
                                        
                                        {% if form.thuavail.errors %}
                                            {% for error in form.thuavail.errors %}
                                            <div class = "formerror">{{ error }}</div>
                                            {% endfor %}            
                                        {% endif %}
                            </div>
                
                            
                            <div> {{form.friavail(class = "form-control form-control-lg mb-3", placeholder="Friday Availability - Required")}} 
                                        
                                        {% if form.friavail.errors %}
                                            {% for error in form.friavail.errors %}
                                            <div class = "formerror">{{ error }}</div>
                                            {% endfor %}            
                                        {% endif %}
                            </div>
                
                        
                            <div> {{form.satavail(class = "form-control form-control-lg mb-3", placeholder="Saturday Availability - Required")}} 
                                        
                                        {% if form.satavail.errors %}
                                            {% for error in form.satavail.errors %}
                                            <div class = "formerror">{{ error }}</div>
                                            {% endfor %}            
                                        {% endif %}
                            </div>
                
                            
                            <div> {{form.sunavail(class = "form-control form-control-lg mb-3", placeholder="Sunday Availability - Required")}} 
                                        
                                        {% if form.sunavail.errors %}
                                            {% for error in form.sunavail.errors %}
                                            <div class = "formerror">{{ error }}</div>
                                            {% endfor %}            
                                        {% endif %}
                            </div>

                           <div class="container">
                 
                                            <div class="d-grid gap-2">
                                                <button type="button"  class="btn btn-primary"data-previous>Previous</button>
                                            
                                           
                                                <button type="button"  class="btn btn-primary"data-next>Next</button>
                                            </div>
                                    
                                        </div>

                            </div>
                <!--
                           <div class="newhire_card" data-step>
                                 <div class="text-center mb-3">Step 3 of 4</div>
                                    <input id="two_fa_code" class="form"  placeholder = "Two Factor Code" name="two_fa_code">
                                        <div class="alert alert9-error alert-danger" style="display:none" role="alert">
                                        Incorrect Code. Please Try Again.
                                        </div>
                                        
                                        <div class="alert alert9-info alert-success"style="display:none" role="alert">
                                            Authentication Complete. Click Next.
                                        </div>


                                        <div class="container">    
                                            <div class = "d-grid gap-2">
                                                <button type="button" id="get_two_fa_token" class="btn btn-primary mb-2" >Click to get 2 factor text</button>
                                                <button  type="button" id="get_two_fa_token_verify"   class="btn btn-primary mb-3" >Click to Verify Code </button>
                                            </div>
                                        </div>
                                        <div class="container">
                 
                                            <div class="d-grid gap-2">
                                                <button type="button"  class="btn btn-primary"data-previous>Previous</button>
                                                <button type="button"  id="two_fa_phone_check_next" class="btn btn-primary" style="display:none" data-next>Next</button>
                                            </div>
                                
                                        </div>

                            </div>
                        -->                          
                            <div class="newhire_card col-lg-6 col-md-8 col-sm-10 mx-auto "data-step>
                                <div class="text-center mb-3">Step 4 of 4</div>
                                    <div class = "container">
                                        <div id="form-submit" class="d-grid gap-2">
                                        {{form.submit2(class_="btn btn-primary")}}
                                        <button type="button"  class="btn btn-primary"data-previous>Previous</button>    
                                        </div>
                            
                                    </div>
                            </div>

                        </form>     

                            <div class="alert alert-info" style="display: none;"></div>     
          
                   
   
               

                        <script>
                           // function NewHire(e) {
                           //     e.preventDefault();
                            //    document.getElementById("demo").innerHTML = "Hello World";
                           //     }
                        </script>
                        <script>
                           
                           var password_check_next = 0
                            $(document).ready(function(e){
                                
                                const passworderror = document.querySelector(".alert4-error")
                                $("#password2").on("input", function(e){
                                    var password1=$("#password").val();
                                    console.log(password1)
                                    var textinpassword=$("#password2").val();
                                    console.log(password1)
                                    console.log(textinpassword)
                                    if (password1 == textinpassword) {
                                        console.log("winner");
                                        passworderror.style.display="none";
                                        password_check_next = 1;
                                        console.log('passwords match',password_check_next)
                                        CheckNextButton()
                                    }
                                    else {
                                        passworderror.style.display = "";
                                        passworderror.innerHTML = `passwords not matching`;
                                        password_check_next = 0;
                                        console.log('passwords not match', password_check_next);
                                        signup_next_button.style.display="none";
                                        
                                    }
                                    
                                })
                                
                            })
                            
                        </script>
                      

                        <script>
                            const email_error = document.querySelector(".alert-error");
                            const email_good = document.querySelector(".alert-info");
                            var email_check_next = 0;
                            $(document).ready(function(e){
                                
                                $("#live_search_first").on("input",function(e){
                                    var textinlivebox= $("#live_search_first").val();
                                    email_error.style.display = "none";
                                    $.ajax({
                                        method:"POST",
                                        url:"/email_livesearch",
                                        data:{text:textinlivebox},
                                        success:function(res){
                                            textinlivebox= $("#live_search_first").val();
                                            for (var i = 0; i < res.length; i++){
                                                console.log(email_check_next);
                                                if (res[i].email == textinlivebox){
                                                    console.log("we match");
                                                    email_check_next = 0;
                                                    console.log(email_check_next)
                                                    email_error.style.display = "";
                                                    email_good.style.display = "none";
                                                    signup_next_button.style.display="none";
                                                    CheckNextButton()
                                                }
                                                else {
                                                    email_check_next = 1;
                                                    console.log(email_check_next);
                                                    email_good.style.display = "";
                                                    email_error.style.display = "none"
                                                    CheckNextButton()
                                                }
                                            };
                                        }
                                    })
                                });
                            })
                        </script>

                        <script>
                                
                                const info2 = document.querySelector(".alert2-info");
                                const error2 = document.querySelector(".alert2-error")
                                const info3 = document.querySelector(".alert3-info");
                                const error3 = document.querySelector(".alert3-error");
                                const error6 = document.querySelector(".alert6-error");
                                const phoneInputField = document.querySelector("#phone");
                                const phone_button = document.querySelector("#phone_button_verify");
                                const signup_next_button = document.querySelector("#phone_check");
                                const phoneInput = window.intlTelInput(phoneInputField, {
                                    utilsScript:
                                    "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js",
                                });
                                var phone_check_next = 0;
                                    const info = document.querySelector(".alert-info");
                                    phone_button.addEventListener("click" ,async function(e){
                                        e.preventDefault();
                                        console.log("hello")
                                        
                                        await CheckPhone();
                                        await ValidatePhone();
                                        
                                        //await CheckNextButton();
                                })

                                async function CheckPhone(){
                                    
                                    info.style.display = "blank";
                                    info3.style.display = "blank";
                                    error3.style.display = "blank";
                                    error6.style.display = "blank";
                          
                                    //console.log(phone_check_next);
                                    const phone_button = document.querySelector("#phone_button_verify");
                                    
                                    {
                                    
                                    const phoneNumber = phoneInput.getNumber();
                                    document.getElementById("hiddenphone").value = phoneNumber;
                                    info.style.display = "blank";
                                   
                                    info3.style.display = "blank";
                                    error3.style.display = "blank";
                                    error6.style.display = "blank";
                                    const data = new URLSearchParams();
                                    data.append("phone", phoneNumber);
                                        
                                    await fetch("https://phone-look-up-4269.twil.io/lookup", {
                                    method: "POST",
                                    body: data,
                                    
                                    })
                                    .then((response) => response.json())
                                    .then((json) => {
                                    if (json.success) {
                                    checkphone = 0;
                                    console.log('valid number',checkphone);
                                        return;
                                    } 
                                    else {
                                    console.log(json.error);
                                    error6.style.display = "";
                                    
                                    info3.style.display = "";
                                    document.getElementById("phone").readOnly = false;
                                    console.log("oops")
                                    checkphone = 1;
                                    console.log('invalid number', checkphone);
                                        return;
                                    }
                                    
                                    })
                                    .catch((err) => {
                                        error.style.display = "blank";
                                        error.innerHTML = `Something went wrong: ${err}`;
                                    });
                                    
                                    }  
                                }

                                async function ValidatePhone(){
                                    
                                    info.style.display = "none";
                                    
                                    info3.style.display = "none";
                                    error3.style.display = "none";
                                    const phone_button = document.querySelector("#phone_button_verify");
                                    //e.preventDefault();
                                    $.ajax({
                                        url: '/verifyphonetoday',
                                        data : {
                                            mobilephone : $('#phone').val(),
                                            mobilephone2 :$('#hiddenphone').val(),                  
                                        },
                                        type: 'POST',
                                            success: function(response){
                                            info3.style.display = "none";
                                            error3.style.display = "none";
                                            console.log("api" + response) 
                                            //console.log("checkphone" + checkphone)   
                                            if ( response == 5){
                                                error3.style.display = "";
                                                error3.innerHTML = `Phone number in already used`; 
                                                info.style.display = "none"
                                                }
                                            else if ( response == 6 && checkphone==0){
                                                info3.style.display="";
                                
                                                document.querySelector("#phone_check").style.display="block";
                                                document.getElementById("phone").readOnly = true;
                                                phone_button.style.display="none";
                                                error6.style.display = "none";
                                                phone_check_next = 1;
                                                console.log("hello")
                                                CheckNextButton()   
                                                }
                                            else if ( response == 7){
                                                error3.style.display = "";
                                                error3.innerHTML = `Please Enter a phonenumber`; 
                                            
                                                }                              
                                            },                                   
                                    })    
                                                    
                                }                                
                        </script>

                        <script>
                                function CheckNextButton(){
                                    console.log('email check' ,email_check_next, 'password check', password_check_next, 'phone check', phone_check_next)
                                    if (password_check_next ===1 && email_check_next ===1 && phone_check_next === 1){
                                        signup_next_button.style.display="";
                                        phone_button.style.display="none";
                                        console.log('password check same' ,password_check_next)
                                    }
                                    else {signup_next_button.style.display="none"};
                                }
                        </script>
                
                        <script>

                    const multiStepForm = document.querySelector("[data-multi-step]")
                    const formSteps = [...multiStepForm.querySelectorAll("[data-step]")]
                    let currentStep = formSteps.findIndex(step => {
                        return step.classList.contains("active")
                    })
                    if (currentStep <0 ){
                        currentStep=0
                        showCurrentStep()
                        
                    }
    
                    
    
                    multiStepForm.addEventListener("click", e => {
                        let incrementor
                        if (e.target.matches("[data-next]")){
    
                            incrementor = 1
                        } else if (e.target.matches("[data-previous]")){
                            incrementor = -1
                        } 
                        
                        if (incrementor == null) return
                        const inputs = [...formSteps[currentStep].querySelectorAll("input")]
                        const allValid = inputs.every(input => input.reportValidity())
                        if (allValid) {
                            currentStep += incrementor
                            showCurrentStep()
                        }
                      
                       
                        console.log(currentStep)
                    })
                    
                    function showCurrentStep(){
                        formSteps.forEach((step, index) => {
                            step.classList.toggle("active", index === currentStep)
                        })
                    }
    
                        </script>
    
                        <script>
                            const two_fa_request = document.querySelector("#get_two_fa_token")
                            two_fa_request.addEventListener('click', function(e){
                                e.preventDefault,
                                console.log("requesting code")
                                $.ajax({
                                    url:'/newhire_verify2fa',
                                    data: {
                                        phone: $('#hiddenphone').val(),
                                    },
                                    type:'POST',
                                    success: console.log("you did it")
                                })
                            })
                        </script>

                        <script>
                            const two_fa_request_token = document.querySelector("#get_two_fa_token_verify")
                            const info2fa = document.querySelector(".alert9-info");
                            const error2fa = document.querySelector(".alert9-error");
                            two_fa_request_token.addEventListener('click', function(e){
                                console.log("requesting code")
                                $.ajax({
                                    url:'/newhire_verify2fa_check',
                                    data: {
                                        phone: $('#hiddenphone').val(),
                                        token: $('#two_fa_code').val(),
                                    },
                                    type:'POST',
                                    success: function(response){
                                        info2fa.style.display = "none";
                                        error2fa.style.display = "none";
                                        console.log(response)
                                        if (response == 0){
                                            error2fa.style.display="";
                                            error2fa.innerHTML='Invalide code. Please Try Again';
                                    }
                                        else if (response ==1){
                                            info2fa.style.display="";
                                            two_fa_request_token.style.display='none';
                                            two_fa_request.style.display='none';
                                            document.querySelector('#two_fa_phone_check_next').style.display="block",
                                            console.log("code excepted")
                                    }
                                }
                                })
                            })
                        </script>

                                                                




                                                           